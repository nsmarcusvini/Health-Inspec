<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Health Inspec</title>
    <link rel="stylesheet" href="index.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css"/>

    <script src="assets/js/funcoes.js"></script>
    <script src="../src/controllers/usuarioController.js"></script>
</head>

<body>
    <div class="register-dark-body-container">
        <div class="register-container">
            <div class="close-register-button">&times;</div>

            <div class="form">
                <h2>Cadastro</h2>

                <form id="form-cadastro" method="post" onsubmit="cadastrar()" class="form-columns">
                    <div class="form-row">
                        <div class="form-element">
                            <label for="corporateName">Razão social</label>
                            <input type="text" name="corporateName" id="corporateName" placeholder="Health Inspec" value="Albert Einstein">
                        </div>
                        
                        <div class="form-element">
                            <label for="cnpj">CNPJ</label>
                            <input type="text" name="cnpj" id="cnpj" placeholder="XX. XXX. XXX/0001-XX" value="12345678912345">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-element">
                            <label for="email">E-mail</label>
                            <input type="text" name="email" id="email" placeholder="health_inspec@gmail.com" value="albert_einstein@email.com">
                        </div>

                        <div class="form-element">
                            <label for="phoneNumber">Telefone</label>
                            <input type="text" data-mask="(00) 00000-0000" name="phoneNumber" id="phoneNumber" placeholder="00 12345-6789" value="12345678912">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-element">
                            <label for="cep">CEP</label>
                            <input type="text" name="cep" id="cep" placeholder="0000-0000" value="00000000">
                        </div>

                        <div class="form-element">
                            <label for="publicPlace">Logradouro</label>
                            <input type="text" name="publicPlace" id="publicPlace" placeholder="Rua exemplo, 111" value="teste">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-element">
                            <label for="state">Estado</label>
                            <input type="text" name="state" id="state" placeholder="SP" value="sp">
                        </div>
                        
                        <div class="form-element">
                            <label for="city">Cidade</label>
                            <input type="text" name="city" id="city" placeholder="São Paulo" value="sp">
                        </div>
                    </div>

                    <div class="form-row">
                        <div class="form-element">
                            <label for="password">Senha</label>
                            <input type="password" name="password" id="password" placeholder="******" value="Teste123*">
                        </div>

                        <div class="form-element">
                            <label for="passwdConfirmation">Confirme a senha</label>
                            <input type="password" name="passwdConfirmation" id="passwdConfirmation" placeholder="******" value="Teste123*">
                        </div>
                    </div>

                    <div class="form-element form-row">
                        <button>Cadastrar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <div id="div_aguardar" class="loading-div" style="display: none;">
        <img src="../apiCadastro/api-projeto-site/public/assets/circle-loading.gif" id="loading-gif" style="display: none;">
    </div>

    <div class="login-dark-body-container">
        <div class="login-container">
            <div class="close-login-button">&times;</div>
            <div class="form">
                <h2>Login</h2>
                
                <div class="form-element">
                    <label for="loginEmail">Email</label>
                    <input type="text" id="loginEmail" placeholder="health_inspec@gmail.com">
                </div>

                <div class="form-element">
                    <label for="loginPassword">Senha</label>
                    <input type="password" id="loginPassword" placeholder="******">
                    <!-- <i class="far fa-eye"></i> -->
                </div>

                <div class="form-element">
                    <button>Entrar</button>
                </div>
            </div>
        </div>
    </div>

    <div class="header-image">
        <div class="header-container">
            <div class="header">
                <span>Health Inspec</span>

                <ul>
                    <li id="beginButton" class="current"><a href="#div-begin">Início</a></li>
                    <li id="workProcessButton"><a href="#div-process">Como funciona</a></li>
                    <li id="aboutUsButton"><a href="#div-about-us">Sobre nós</a></li>
                    <li id="registerButton">Cadastre-se</li>
                    <li id="loginButton">Login</li>
                </ul>
            </div>
        </div>

        <div id="div-begin" class="page-title-container">
            <div class="page-title">
                <span class="title">
                    Suas máquinas de atendimento <br>
                    muito mais eficientes e seguras!
                </span>

                <span class="description">
                    Garantimos segurança no atendimento <br>
                    dos estabelecimentos de saúde com nosso <br>
                    monitoramento de CPUs dos totens e das <br>
                    máquinas da recepção!
                </span>
            </div>
        </div>
    </div>

    <div id="div-process" class="work-process-container">
        <div class="centered-title">
            <span class="work-process-title">
                Como nosso produto <span>funciona?</span>
            </span>
            <span class="work-process-subtitle">
                Health Inspec te ajuda a ter um atendimento melhor
            </span>

            <div class="line"></div>
        </div>

        <div class="phases-container">
            <div class="steps">
                <div class="step-image">
                    <img src="./assets/implantacao.png">
                </div>
                <span class="step-title">Implantação</span>
                <br>
                <span class="step-subtitle">Implementamos nossa aplicação nos computadores da recepção e nos totens de
                    atendimento</span>
            </div>

            <div class="arrow">
                <img src="./assets/arrow.png">
            </div>

            <div class="steps">
                <div class="step-image">
                    <img src="./assets/monitoramento.png">
                </div>
                <span class="step-title">Monitoramento</span>
                <br>
                <span class="step-subtitle">As máquinas monitoradas apresentarão os picos de processos que causam lentidão no sistema</span>
            </div>

            <div class="arrow">
                <img src="./assets/arrow.png">
            </div>

            <div class="steps rocket-div">
                <div class="rocket-image">
                    <img src="./assets/agilidade.png">
                </div>
                <span class="step-title">Agilidade</span>
                <br>
                <span class="step-subtitle">Com nossos serviços, as máquinas terão melhor desempenho e o atendimento
                    será mais rápido</span>
            </div>
        </div>

    </div>

    <div id="div-about-us" class="about-us">
        <div class="about-us-container">
            <div class="about-us-title">
                <span>Sobre nós</span>
            </div>

            <div class="line-about-us"></div>

            <div class="about-us-subtitle">
                <span>Fundada em 2022, Health Inspec é uma empresa voltada para o monitoramento de máquinas de estabelecimentos de saúde. Com nossos serviços, os hospitais e postos conseguem impedir problemas nos computadores e totens responsáveis pelos atendimentos, evitando, assim, lentidão e instabilidade. Nosso time de Tech acompanha o desenvolvimento do software que irá monitorar as máquinas do estabelecimento, a fim de alertar a equipe de suporte caso seja detectado algo fora dos padrões e que pode gerar travamento ou sobrecarga no sistema. Além disso, Health Inspec também te ajudará a controlar os processos abertos nos computadores para que, caso algum processo indevido esteja aberto consumindo memória, seja encerrado para evitar lentidão e melhorar a eficiência das máquinas.</span>
                <img src="assets/about-us-monitoring.png">
            </div>
        </div>
    </div>

    <footer>
        <div class="footerContent">
            <p>Monitorar para melhorar ❤☕</p>
        </div>
        <div class="footerBottom">
            <p>copyright&copy; 2020. Developed by <span>Health Inspec</span></p>
        </div>
    </footer>
</body>

</html>
<script src="assets/jsEffects/scrollreveal.min.js"></script>
<script src="assets/jsEffects/comandosCSS.js"></script>
<script>
    const srr = ScrollReveal({
        origin: 'top',
        distance: '60px',
        duration: 1000,
        delay: 100
    });
    srr.reveal('work-process-container, .phases-container, .steps, .arrow', { interval: 300 })
</script>

<script src="index.js"></script>

<script>
    function limparFormularioCadastro() {
        document.getElementById("form-cadastro").reset();
    }

    function cadastrar() {
        aguardar();

        let formulario = new URLSearchParams(new FormData(document.getElementById("form-cadastro")));

        let corporateName = formulario.get("corporateName");
        let cnpj = formulario.get("cnpj");
        let email = formulario.get("email");
        let phoneNumber = formulario.get("phoneNumber")
        let cep = formulario.get("cep");
        let publicPlace = formulario.get("publicPlace");
        let state = formulario.get("state");
        let city = formulario.get("city");
        let password = formulario.get("password");
        let passwdConfirmation = formulario.get("passwdConfirmation");

        // TODO: VERIFICAR AS VALIDAÇÕES QUE ELES ESTÃO APRENDENDO EM ALGORITMOS 
        let registerInputs = Array.from(document.querySelectorAll(".form-element input"));

        registerInputs.forEach(input => {
            if (input.value == "") {
                Swal.fire({
                    position: 'top-center',
                    icon: 'error',
                    title: 'Preencha todos os campos!',
                    showConfirmButton: false,
                    timer: 1500
                });

                return false;
            }
        });

        // if (corporateName== "" || email == "" || password == "" || passwdConfirmation == "") {
        //     Swal.fire({
        //     position: 'top-center',
        //     icon: 'error',
        //     title: 'Preencha todos os campos!',
        //     showConfirmButton: false,
        //     timer: 1500
        //     });
        //     return false;
        // }

        if (corporateName.length > 45) {
            Swal.fire({
                position: 'top-center',
                icon: 'error',
                title: 'Razão social não deve passar de 45 caracteres!',
                showConfirmButton: false,
                timer: 1500
            });
            
            return false;
        }

        if (cnpj.length > 14) {
            Swal.fire({
                position: 'top-center',
                icon: 'error',
                title: 'CNPJ não deve passar de 14 caracteres!',
                showConfirmButton: false,
                timer: 1500
            });
            
            return false;
        }

        if (email.length > 100) {
            Swal.fire({
                position: 'top-center',
                icon: 'error',
                title: 'Email não deve passar de 100 caracteres!',
                showConfirmButton: false,
                timer: 1500
            });
            
            return false;
        }
        
        if (!email.includes("@") || !email.includes(".com")) {
            Swal.fire({
                position: 'top-center',
                icon: 'error',
                title: 'Email deve conter "@" e ".com"!',
                showConfirmButton: false,
                timer: 1500
            });
            
            return false;
        }

        if (phoneNumber.length > 11) {
            Swal.fire({
                position: 'top-center',
                icon: 'error',
                title: 'Telefone não deve passar de 11 dígitos!',
                showConfirmButton: false,
                timer: 1500
            });
            
            return false;
        }

        if (cep.length > 8) {
            Swal.fire({
                position: 'top-center',
                icon: 'error',
                title: 'CEP não deve passar de 8 dígitos!',
                showConfirmButton: false,
                timer: 1500
            });
            
            return false;
        }

        if (publicPlace.length > 45) {
            Swal.fire({
                position: 'top-center',
                icon: 'error',
                title: 'Logradouro não deve passar de 45 caracteres!',
                showConfirmButton: false,
                timer: 1500
            });
            
            return false;
        }

        if (state.length > 15) {
            Swal.fire({
                position: 'top-center',
                icon: 'error',
                title: 'Estado não deve conter mais de 15 caracteres!',
                showConfirmButton: false,
                timer: 1500
            });
            
            return false;
        }

        if (city.length > 30) {
            Swal.fire({
                position: 'top-center',
                icon: 'error',
                title: 'Cidade não deve conter mais de 30 caracteres!',
                showConfirmButton: false,
                timer: 1500
            });
            
            return false;
        }

        if (password.length > 20) {
            Swal.fire({
                position: 'top-center',
                icon: 'error',
                title: 'Senha não deve conter mais de 20 caracteres!',
                showConfirmButton: false,
                timer: 1500
            });
            
            return false;
        }
        
        if (password != passwdConfirmation) {
            Swal.fire({
                position: 'top-center',
                icon: 'error',
                title: 'As senhas devem ser iguais!',
                showConfirmButton: false,
                timer: 1500
            });;
            
            return false;
        }

        fetch("/usuarios/cadastrar", {
            method: "POST",
            body: formulario
        }).then(function (resposta) {

            console.log("resposta: ", resposta);

            if (resposta.ok) {
                Swal.fire({
                    position: 'top-center',
                    icon: 'success',
                    title: 'Cadastrado(a) com sucesso!',
                    showConfirmButton: false,
                    timer: 1500
                });

                setTimeout(() => {
                    window.location = "dashboard.com";
                }, 1600);
                
                limparFormularioCadastro();
            } else {
                throw("Houve um erro ao tentar realizar o cadastro!");
            }
        }).catch(function (resposta) {
            console.log(`#ERRO: ${resposta}`);
        }); 

        return false;
    }

    // CODIGO DA API PARA O LOGIN
    function limparFormulario() {
        document.getElementById("form_login").reset();
    }

    function entrar() {
        aguardar();

        var formulario = new URLSearchParams(new FormData(document.getElementById("form_login")));

        var email = formulario.get("email");
        var senha = formulario.get("senha");

        console.log("FORM LOGIN: ", email);
        console.log("FORM SENHA: ", senha);

        // TODO: VERIFICAR AS VALIDAÇÕES QUE ELES ESTÃO APRENDENDO EM ALGORITMOS 
        if (email == "" || senha == "") {
            Swal.fire({
            position: 'top-center',
            icon: 'error',
            title: 'Preencha todos os campos!',
            showConfirmButton: false,
            timer: 1500
            });
            return false;
        }

        if (email.indexOf("@") == -1 || email.indexOf(".com") == -1) {
            Swal.fire({
            position: 'top-center',
            icon: 'error',
            title: 'Email deve conter "@" e ".com"!',
            showConfirmButton: false,
            timer: 1500
            });
            return false;
        }

        fetch("/usuarios/autenticar", {
            method: "POST",
            body: formulario
        }).then(function (resposta) {
            console.log("ESTOU NO THEN DO entrar()!")

            if (resposta.ok) {
                console.log(resposta);

                resposta.json().then(json => {
                    console.log(json);
                    console.log(JSON.stringify(json));

                    sessionStorage.EMAIL_USUARIO = json.email;
                    sessionStorage.NOME_USUARIO = json.nome;
                    sessionStorage.ID_USUARIO = json.id;

                    setTimeout(function () {
                        window.location = "curiosidades.html";
                    }, 500); // apenas para exibir o loading

                });

            } else {
                document.querySelector(".loginErrorText").style.display = "block";
                setTimeout(() => {
                    document.querySelector(".loginErrorText").style.display = "none";
                }, 2000);

                resposta.text().then(texto => {
                    console.error(texto);
                });
            }

        }).catch(function (erro) {
            console.log(erro);
        })

        return false;
    }
</script>